<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.8"/>
<title>the module system for language voba: Main Page</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">the module system for language voba
   &#160;<span id="projectnumber">1.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.8 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li class="current"><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">the module system for language voba Documentation</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The module system for voba language.</p>
<p>see the doxygen version at <a href="https://wcy123.github.io/voba_module">https://wcy123.github.io/voba_module</a></p>
<h2>The first module</h2>
<h3>declare a module</h3>
<p>see <code>examples/ex1/hello.h</code></p>
<div class="fragment"><div class="line"><span class="preprocessor">#pragma once</span></div>
<div class="line"><span class="preprocessor">#define VOBA_MODULE_ID &quot;eaebdb3c-a436-11e4-bf65-0800272ae0cc&quot;</span></div>
<div class="line"><span class="preprocessor">#define VOBA_SYMBOL_TABLE(XX)                           \</span></div>
<div class="line"><span class="preprocessor">    XX(hello_world)                                     \</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor">#define VOBA_MODULE_NAME &quot;hello&quot;</span></div>
<div class="line"><span class="preprocessor">#include &lt;voba/module_end.h&gt;</span></div>
</div><!-- fragment --><p>It is a simple C header file and it defines 3 macros.</p><ol type="1">
<li><code>VOBA_MODULE_ID</code>: it is a unique id. It is generated, e.g. by <code>uuidgen -t</code></li>
<li><code>VOBA_SYMBOL_TABLE(XX)</code>: A macro to define a set of symbols.</li>
<li><code>VOBA_MODULE_NAME</code>: The name of the module.</li>
<li>we must have <code>voba/module_end.h</code> in the end.</li>
</ol>
<h3>define the module</h3>
<p>see <code>examples\ex1\hello.c</code></p>
<div class="fragment"><div class="line"><span class="preprocessor">#define EXEC_ONCE_TU_NAME &quot;hello&quot;</span></div>
<div class="line"><span class="preprocessor">#include &lt;voba/value.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &quot;hello.h&quot;</span></div>
<div class="line"></div>
<div class="line"><a class="codeRef" doxygen="/home/chunywan/d/working/voba/voba_value/docs/voba_value.tag:https://wcy123.github.io/voba_value/" href="https://wcy123.github.io/voba_value/fun_8h.html#a87beae3391f3bf28034f8507dceaa5c7">VOBA_FUNC</a> <span class="keyword">static</span> <a class="codeRef" doxygen="/home/chunywan/d/working/voba/voba_value/docs/voba_value.tag:https://wcy123.github.io/voba_value/" href="https://wcy123.github.io/voba_value/overview_8h.html#a4b4beb86106b46a64b829791f267f60b">voba_value_t</a> hello_world(<a class="codeRef" doxygen="/home/chunywan/d/working/voba/voba_value/docs/voba_value.tag:https://wcy123.github.io/voba_value/" href="https://wcy123.github.io/voba_value/overview_8h.html#a4b4beb86106b46a64b829791f267f60b">voba_value_t</a> <span class="keyword">self</span>, <a class="codeRef" doxygen="/home/chunywan/d/working/voba/voba_value/docs/voba_value.tag:https://wcy123.github.io/voba_value/" href="https://wcy123.github.io/voba_value/overview_8h.html#a4b4beb86106b46a64b829791f267f60b">voba_value_t</a> args)</div>
<div class="line">{</div>
<div class="line">    printf(<span class="stringliteral">&quot;Hello Module\n&quot;</span>);</div>
<div class="line">    <span class="keywordflow">return</span> <a class="codeRef" doxygen="/home/chunywan/d/working/voba/voba_value/docs/voba_value.tag:https://wcy123.github.io/voba_value/" href="https://wcy123.github.io/voba_value/small_8h.html#a0cbe908387e7765090f0ee3f4de435b8">VOBA_NIL</a>;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line">EXEC_ONCE_PROGN{</div>
<div class="line">    <a class="code" href="module_8h.html#a75f506da31f089d7a219f73a91a754d3">VOBA_DEFINE_MODULE_SYMBOL</a>(s_hello_world, <a class="codeRef" doxygen="/home/chunywan/d/working/voba/voba_value/docs/voba_value.tag:https://wcy123.github.io/voba_value/" href="https://wcy123.github.io/voba_value/fun_8h.html#afe87a8eb49c61b53146652fa7e7ac8af">voba_make_func</a>(hello_world));</div>
<div class="line">}</div>
<div class="line"><span class="comment">// the main entry</span></div>
<div class="line"><a class="codeRef" doxygen="/home/chunywan/d/working/voba/voba_value/docs/voba_value.tag:https://wcy123.github.io/voba_value/" href="https://wcy123.github.io/voba_value/overview_8h.html#a4b4beb86106b46a64b829791f267f60b">voba_value_t</a> voba_init(<a class="codeRef" doxygen="/home/chunywan/d/working/voba/voba_value/docs/voba_value.tag:https://wcy123.github.io/voba_value/" href="https://wcy123.github.io/voba_value/overview_8h.html#a4b4beb86106b46a64b829791f267f60b">voba_value_t</a> this_module)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">return</span> <a class="codeRef" doxygen="/home/chunywan/d/working/voba/voba_value/docs/voba_value.tag:https://wcy123.github.io/voba_value/" href="https://wcy123.github.io/voba_value/small_8h.html#a0cbe908387e7765090f0ee3f4de435b8">VOBA_NIL</a>;</div>
<div class="line">}</div>
</div><!-- fragment --><p>For <code>EXEC_ONCE_PROGN</code> and <code>EXEC_ONCE_PROGN</code>, refer to <a href="https://github.com/wcy123/exec_once.git">https://github.com/wcy123/exec_once.git</a></p>
<p>The module definition must import(include) the module head file by itself.</p>
<p>The symbol <code>hello_world</code> is prefixed with <code>s_</code> for C identifier.</p>
<p><code>VOBA_DEFINE_MODULE_SYMBOL</code> is used to define the value of a symbol.</p>
<p><code>voba_init</code> is the entry function of the module when module is loaded, in this example, it does nothing.</p>
<h3>build the module</h3>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;gcc -I ../../../build/include -std=c99 -fPIC -o libhello.so -shared hello.c</div>
</div><!-- fragment --><p>now, we have <code>libhello.so</code>, the module.</p>
<h3>how to use the module</h3>
<p>see <code>examples\ex1\ex1.c</code></p>
<div class="fragment"><div class="line"><span class="preprocessor">#define EXEC_ONCE_TU_NAME &quot;main&quot;</span></div>
<div class="line"><span class="preprocessor">#define EXEC_ONCE_DEPENDS {&quot;voba.module&quot;}</span></div>
<div class="line"><span class="preprocessor">#include &lt;voba/value.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &quot;hello.h&quot;</span></div>
<div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])</div>
<div class="line">{</div>
<div class="line">    exec_once_init();</div>
<div class="line">    <a class="codeRef" doxygen="/home/chunywan/d/working/voba/voba_value/docs/voba_value.tag:https://wcy123.github.io/voba_value/" href="https://wcy123.github.io/voba_value/overview_8h.html#a4b4beb86106b46a64b829791f267f60b">voba_value_t</a> args[] = {0};</div>
<div class="line">    <a class="codeRef" doxygen="/home/chunywan/d/working/voba/voba_value/docs/voba_value.tag:https://wcy123.github.io/voba_value/" href="https://wcy123.github.io/voba_value/apply_8h.html#a16186dc39b10214b25592bec19c6b761">voba_apply</a>(voba_symbol_value(s_hello_world),<a class="codeRef" doxygen="/home/chunywan/d/working/voba/voba_value/docs/voba_value.tag:https://wcy123.github.io/voba_value/" href="https://wcy123.github.io/voba_value/tuple_8h.html#a68e97a70e69fcea01dbcd7c3bbc7aa49">voba_make_tuple</a>(args));</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment --><p>For <code>EXEC_ONCE_TU_NAME</code>, refer to <a href="https://github.com/wcy123/exec_once.git">https://github.com/wcy123/exec_once.git</a>. We must define it before including <code>voba/value.h</code></p>
<p>To import the module, just <code>include "hello.h"</code></p>
<p><code>exec_once_init()</code> must be invoked in the main function in order to load the module.</p>
<p>Because <code>"hello.h"</code> is included, so that the C variable, <code>s_hello_world</code> is declared, and it will be defined after loading the module, <code>libhello.so</code>.</p>
<p>If there is something wrong, set environment variable <code>VOBA_MODULE_DEBUG</code> to <code>1</code> for troubleshooting.</p>
<h3>how to find the module's shared library</h3>
<p>There two types of module, public and private. If a module name starts with <code>"."</code>, it is a private module, otherwise it is a public module.</p>
<p>There is an array of search path, called, <code>voba_path</code>, which is initialized by the environment variable, <code>VOBA_PATH</code>. For public module, every element is tried for searching the shared library. For example,</p>
<p>if <code>voba_path</code> is</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;path1</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;path2</div>
</div><!-- fragment --><p>And if the module name is <code>a/b/c/your_module_name</code>, then the following files are searched in order.</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;path1/a/b/c/libyour_module_name.so</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;path2/a/b/c/libyour_module_name.so</div>
</div><!-- fragment --><p>A private module name starts with <code>"."</code>, for example, <code>"./my/private_module"</code>. <code>voba_path</code> is not used for private module, the path is relative to the importing module. Here is an example in <code>examples/ex2</code></p>
<p>The directory structure of <code>examples/ex2</code> </p><pre></pre><pre>├── build.sh         (how to build everything)
├── ex2              (the executable file build from ex2.c)
├── ex2.c            (main entry point)
├── m1               (m1 module)
│   ├── libmain.so   (shared library for m1/main)
│   ├── main.c
│   ├── main.h
│   └── _private     (directory for private modules)
│       ├── foo.c
│       ├── foo.h
│       └── libfoo.so (shared library for ./_private/foo)
└── m2
    ├── libmain.so
    ├── main.c
    ├── main.h
    └── _private
        ├── foo.c
        ├── foo.h
        └── libfoo.so (shared library for ./_private/foo)
</pre><h4>ex2.c</h4>
<p><code> </p><div class="fragment"><div class="line"><span class="preprocessor">#define EXEC_ONCE_TU_NAME &quot;main&quot;</span></div>
<div class="line"><span class="preprocessor">#define EXEC_ONCE_DEPENDS {&quot;voba.module&quot;}</span></div>
<div class="line"><span class="preprocessor">#include &lt;voba/value.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &quot;m1/main.h&quot;</span> <span class="comment">// import m1/main</span></div>
<div class="line"><span class="preprocessor">#include &quot;m2/main.h&quot;</span> <span class="comment">// import m2/main</span></div>
<div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])</div>
<div class="line">{</div>
<div class="line">    exec_once_init();</div>
<div class="line">    <a class="codeRef" doxygen="/home/chunywan/d/working/voba/voba_value/docs/voba_value.tag:https://wcy123.github.io/voba_value/" href="https://wcy123.github.io/voba_value/overview_8h.html#a4b4beb86106b46a64b829791f267f60b">voba_value_t</a> args[] = {0};</div>
<div class="line">    <a class="codeRef" doxygen="/home/chunywan/d/working/voba/voba_value/docs/voba_value.tag:https://wcy123.github.io/voba_value/" href="https://wcy123.github.io/voba_value/apply_8h.html#a16186dc39b10214b25592bec19c6b761">voba_apply</a>(voba_symbol_value(s_hello_m1),<a class="codeRef" doxygen="/home/chunywan/d/working/voba/voba_value/docs/voba_value.tag:https://wcy123.github.io/voba_value/" href="https://wcy123.github.io/voba_value/tuple_8h.html#a68e97a70e69fcea01dbcd7c3bbc7aa49">voba_make_tuple</a>(args)); <span class="comment">// invoke s_hello_m1</span></div>
<div class="line">    <a class="codeRef" doxygen="/home/chunywan/d/working/voba/voba_value/docs/voba_value.tag:https://wcy123.github.io/voba_value/" href="https://wcy123.github.io/voba_value/apply_8h.html#a16186dc39b10214b25592bec19c6b761">voba_apply</a>(voba_symbol_value(s_hello_m2),<a class="codeRef" doxygen="/home/chunywan/d/working/voba/voba_value/docs/voba_value.tag:https://wcy123.github.io/voba_value/" href="https://wcy123.github.io/voba_value/tuple_8h.html#a68e97a70e69fcea01dbcd7c3bbc7aa49">voba_make_tuple</a>(args)); <span class="comment">// invoke s_hello_m2</span></div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment --><p> </code></p>
<p>it imports <code>m1/main</code> and <code>m2/main</code> respectively.</p>
<h4>m1/main.h,m1/main.c, m2/main.h and m2/main.c</h4>
<ol type="1">
<li>m1/main.h <code> <div class="fragment"><div class="line"><span class="preprocessor">#pragma once</span></div>
<div class="line"><span class="preprocessor">#define VOBA_MODULE_ID &quot;b0d9b18a-a47c-11e4-bf65-0800272ae0cc&quot;</span></div>
<div class="line"><span class="preprocessor">#define VOBA_SYMBOL_TABLE(XX)                           \</span></div>
<div class="line"><span class="preprocessor">    XX(hello_m1)                                        \</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor">#define VOBA_MODULE_NAME &quot;m1/main&quot;</span></div>
<div class="line"><span class="preprocessor">#include &lt;voba/module_end.h&gt;</span></div>
<div class="line"></div>
<div class="line"></div>
<div class="line"></div>
</div><!-- fragment --> </code></li>
</ol>
<ol type="1">
<li>m2/main.h <code> <div class="fragment"><div class="line"><span class="preprocessor">#pragma once</span></div>
<div class="line"><span class="preprocessor">#define VOBA_MODULE_ID &quot;7cd26050-a484-11e4-bf65-0800272ae0cc&quot;</span></div>
<div class="line"><span class="preprocessor">#define VOBA_SYMBOL_TABLE(XX)                           \</span></div>
<div class="line"><span class="preprocessor">    XX(hello_m2)                                        \</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor">#define VOBA_MODULE_NAME &quot;m2/main&quot;</span></div>
<div class="line"><span class="preprocessor">#include &lt;voba/module_end.h&gt;</span></div>
<div class="line"></div>
<div class="line"></div>
<div class="line"></div>
</div><!-- fragment --> </code></li>
</ol>
<p>Note that the uuid of <code>m1/main</code> and <code>m2/main</code> must be different.</p>
<ol type="1">
<li>m1/main.c <code> <div class="fragment"><div class="line"><span class="preprocessor">#define EXEC_ONCE_TU_NAME &quot;m1/main&quot;</span></div>
<div class="line"><span class="preprocessor">#include &lt;voba/value.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &quot;m1/main.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;_private/foo.h&quot;</span></div>
<div class="line"><a class="codeRef" doxygen="/home/chunywan/d/working/voba/voba_value/docs/voba_value.tag:https://wcy123.github.io/voba_value/" href="https://wcy123.github.io/voba_value/fun_8h.html#a87beae3391f3bf28034f8507dceaa5c7">VOBA_FUNC</a> <span class="keyword">static</span> <a class="codeRef" doxygen="/home/chunywan/d/working/voba/voba_value/docs/voba_value.tag:https://wcy123.github.io/voba_value/" href="https://wcy123.github.io/voba_value/overview_8h.html#a4b4beb86106b46a64b829791f267f60b">voba_value_t</a> hello_m1(<a class="codeRef" doxygen="/home/chunywan/d/working/voba/voba_value/docs/voba_value.tag:https://wcy123.github.io/voba_value/" href="https://wcy123.github.io/voba_value/overview_8h.html#a4b4beb86106b46a64b829791f267f60b">voba_value_t</a> <span class="keyword">self</span>, <a class="codeRef" doxygen="/home/chunywan/d/working/voba/voba_value/docs/voba_value.tag:https://wcy123.github.io/voba_value/" href="https://wcy123.github.io/voba_value/overview_8h.html#a4b4beb86106b46a64b829791f267f60b">voba_value_t</a> args)</div>
<div class="line">{</div>
<div class="line">    printf(<span class="stringliteral">&quot;Hello from module 1\n&quot;</span>);</div>
<div class="line">    <a class="codeRef" doxygen="/home/chunywan/d/working/voba/voba_value/docs/voba_value.tag:https://wcy123.github.io/voba_value/" href="https://wcy123.github.io/voba_value/overview_8h.html#a4b4beb86106b46a64b829791f267f60b">voba_value_t</a> xargs[] = {0};</div>
<div class="line">    <a class="codeRef" doxygen="/home/chunywan/d/working/voba/voba_value/docs/voba_value.tag:https://wcy123.github.io/voba_value/" href="https://wcy123.github.io/voba_value/apply_8h.html#a16186dc39b10214b25592bec19c6b761">voba_apply</a>(voba_symbol_value(s_foo),<a class="codeRef" doxygen="/home/chunywan/d/working/voba/voba_value/docs/voba_value.tag:https://wcy123.github.io/voba_value/" href="https://wcy123.github.io/voba_value/tuple_8h.html#a68e97a70e69fcea01dbcd7c3bbc7aa49">voba_make_tuple</a>(xargs));</div>
<div class="line">    <span class="keywordflow">return</span> <a class="codeRef" doxygen="/home/chunywan/d/working/voba/voba_value/docs/voba_value.tag:https://wcy123.github.io/voba_value/" href="https://wcy123.github.io/voba_value/small_8h.html#a0cbe908387e7765090f0ee3f4de435b8">VOBA_NIL</a>;</div>
<div class="line">}</div>
<div class="line">EXEC_ONCE_PROGN{</div>
<div class="line">    <a class="code" href="module_8h.html#a75f506da31f089d7a219f73a91a754d3">VOBA_DEFINE_MODULE_SYMBOL</a>(s_hello_m1, <a class="codeRef" doxygen="/home/chunywan/d/working/voba/voba_value/docs/voba_value.tag:https://wcy123.github.io/voba_value/" href="https://wcy123.github.io/voba_value/fun_8h.html#afe87a8eb49c61b53146652fa7e7ac8af">voba_make_func</a>(hello_m1));</div>
<div class="line">}</div>
<div class="line"><span class="comment">// the main entry</span></div>
<div class="line"><a class="codeRef" doxygen="/home/chunywan/d/working/voba/voba_value/docs/voba_value.tag:https://wcy123.github.io/voba_value/" href="https://wcy123.github.io/voba_value/overview_8h.html#a4b4beb86106b46a64b829791f267f60b">voba_value_t</a> voba_init(<a class="codeRef" doxygen="/home/chunywan/d/working/voba/voba_value/docs/voba_value.tag:https://wcy123.github.io/voba_value/" href="https://wcy123.github.io/voba_value/overview_8h.html#a4b4beb86106b46a64b829791f267f60b">voba_value_t</a> this_module)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">return</span> <a class="codeRef" doxygen="/home/chunywan/d/working/voba/voba_value/docs/voba_value.tag:https://wcy123.github.io/voba_value/" href="https://wcy123.github.io/voba_value/small_8h.html#a0cbe908387e7765090f0ee3f4de435b8">VOBA_NIL</a>;</div>
<div class="line">}</div>
</div><!-- fragment --> </code></li>
</ol>
<ol type="1">
<li>m2/main.c <code> <div class="fragment"><div class="line"><span class="preprocessor">#define EXEC_ONCE_TU_NAME &quot;m2/main&quot;</span></div>
<div class="line"><span class="preprocessor">#include &lt;voba/value.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &quot;m2/main.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;_private/foo.h&quot;</span></div>
<div class="line"><a class="codeRef" doxygen="/home/chunywan/d/working/voba/voba_value/docs/voba_value.tag:https://wcy123.github.io/voba_value/" href="https://wcy123.github.io/voba_value/fun_8h.html#a87beae3391f3bf28034f8507dceaa5c7">VOBA_FUNC</a> <span class="keyword">static</span> <a class="codeRef" doxygen="/home/chunywan/d/working/voba/voba_value/docs/voba_value.tag:https://wcy123.github.io/voba_value/" href="https://wcy123.github.io/voba_value/overview_8h.html#a4b4beb86106b46a64b829791f267f60b">voba_value_t</a> hello_m2(<a class="codeRef" doxygen="/home/chunywan/d/working/voba/voba_value/docs/voba_value.tag:https://wcy123.github.io/voba_value/" href="https://wcy123.github.io/voba_value/overview_8h.html#a4b4beb86106b46a64b829791f267f60b">voba_value_t</a> <span class="keyword">self</span>, <a class="codeRef" doxygen="/home/chunywan/d/working/voba/voba_value/docs/voba_value.tag:https://wcy123.github.io/voba_value/" href="https://wcy123.github.io/voba_value/overview_8h.html#a4b4beb86106b46a64b829791f267f60b">voba_value_t</a> args)</div>
<div class="line">{</div>
<div class="line">    printf(<span class="stringliteral">&quot;hello from module 2\n&quot;</span>);</div>
<div class="line">    <a class="codeRef" doxygen="/home/chunywan/d/working/voba/voba_value/docs/voba_value.tag:https://wcy123.github.io/voba_value/" href="https://wcy123.github.io/voba_value/overview_8h.html#a4b4beb86106b46a64b829791f267f60b">voba_value_t</a> xargs[] = {0};</div>
<div class="line">    <a class="codeRef" doxygen="/home/chunywan/d/working/voba/voba_value/docs/voba_value.tag:https://wcy123.github.io/voba_value/" href="https://wcy123.github.io/voba_value/apply_8h.html#a16186dc39b10214b25592bec19c6b761">voba_apply</a>(voba_symbol_value(s_foo),<a class="codeRef" doxygen="/home/chunywan/d/working/voba/voba_value/docs/voba_value.tag:https://wcy123.github.io/voba_value/" href="https://wcy123.github.io/voba_value/tuple_8h.html#a68e97a70e69fcea01dbcd7c3bbc7aa49">voba_make_tuple</a>(xargs));</div>
<div class="line">    <span class="keywordflow">return</span> <a class="codeRef" doxygen="/home/chunywan/d/working/voba/voba_value/docs/voba_value.tag:https://wcy123.github.io/voba_value/" href="https://wcy123.github.io/voba_value/small_8h.html#a0cbe908387e7765090f0ee3f4de435b8">VOBA_NIL</a>;</div>
<div class="line">}</div>
<div class="line">EXEC_ONCE_PROGN{</div>
<div class="line">    <a class="code" href="module_8h.html#a75f506da31f089d7a219f73a91a754d3">VOBA_DEFINE_MODULE_SYMBOL</a>(s_hello_m2, <a class="codeRef" doxygen="/home/chunywan/d/working/voba/voba_value/docs/voba_value.tag:https://wcy123.github.io/voba_value/" href="https://wcy123.github.io/voba_value/fun_8h.html#afe87a8eb49c61b53146652fa7e7ac8af">voba_make_func</a>(hello_m2));</div>
<div class="line">}</div>
<div class="line"><span class="comment">// the main entry</span></div>
<div class="line"><a class="codeRef" doxygen="/home/chunywan/d/working/voba/voba_value/docs/voba_value.tag:https://wcy123.github.io/voba_value/" href="https://wcy123.github.io/voba_value/overview_8h.html#a4b4beb86106b46a64b829791f267f60b">voba_value_t</a> voba_init(<a class="codeRef" doxygen="/home/chunywan/d/working/voba/voba_value/docs/voba_value.tag:https://wcy123.github.io/voba_value/" href="https://wcy123.github.io/voba_value/overview_8h.html#a4b4beb86106b46a64b829791f267f60b">voba_value_t</a> this_module)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">return</span> <a class="codeRef" doxygen="/home/chunywan/d/working/voba/voba_value/docs/voba_value.tag:https://wcy123.github.io/voba_value/" href="https://wcy123.github.io/voba_value/small_8h.html#a0cbe908387e7765090f0ee3f4de435b8">VOBA_NIL</a>;</div>
<div class="line">}</div>
</div><!-- fragment --> </code></li>
</ol>
<p>Note both <code>m1/main.c</code> and <code>m2/main.c</code> import the module <code>./private/foo.h</code>, but they import different <code>./private/foo</code>.</p>
<h3>foo.h and foo.c</h3>
<ol type="1">
<li><code>m1/_private/foo.h</code> <code> <div class="fragment"><div class="line"><span class="preprocessor">#pragma once</span></div>
<div class="line"><span class="preprocessor">#define VOBA_MODULE_ID &quot;3efb618e-a47d-11e4-bf65-0800272ae0cc&quot;</span></div>
<div class="line"><span class="preprocessor">#define VOBA_SYMBOL_TABLE(XX)                           \</span></div>
<div class="line"><span class="preprocessor">    XX(foo)                                             \</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor">#define VOBA_MODULE_NAME &quot;./_private/foo&quot;</span></div>
<div class="line"><span class="preprocessor">#include &lt;voba/module_end.h&gt;</span></div>
<div class="line"></div>
<div class="line"></div>
<div class="line"></div>
</div><!-- fragment --> </code></li>
</ol>
<ol type="1">
<li><code>m2/_private/foo.h</code> <code> <div class="fragment"><div class="line"><span class="preprocessor">#pragma once</span></div>
<div class="line"><span class="preprocessor">#define VOBA_MODULE_ID &quot;9b0438aa-a484-11e4-bf65-0800272ae0cc&quot;</span></div>
<div class="line"><span class="preprocessor">#define VOBA_SYMBOL_TABLE(XX)                           \</span></div>
<div class="line"><span class="preprocessor">    XX(foo)                                             \</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor">#define VOBA_MODULE_NAME &quot;./_private/foo&quot;</span></div>
<div class="line"><span class="preprocessor">#include &lt;voba/module_end.h&gt;</span></div>
<div class="line"></div>
<div class="line"></div>
<div class="line"></div>
</div><!-- fragment --> </code></li>
</ol>
<p>Note that the uuid is not same, but the module name is same, <code>./_private/foo</code>. It is a private module so the names are not conflicts, one <code>./_private/foo</code> is relative to <code>m1/main</code>, the other is relative to <code>m2/main</code></p>
<ol type="1">
<li><code>m1/_private/foo.c</code> <code> <div class="fragment"><div class="line"><span class="preprocessor">#define EXEC_ONCE_TU_NAME &quot;m1/foo&quot;</span></div>
<div class="line"><span class="preprocessor">#include &lt;voba/value.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &quot;foo.h&quot;</span></div>
<div class="line"><a class="codeRef" doxygen="/home/chunywan/d/working/voba/voba_value/docs/voba_value.tag:https://wcy123.github.io/voba_value/" href="https://wcy123.github.io/voba_value/fun_8h.html#a87beae3391f3bf28034f8507dceaa5c7">VOBA_FUNC</a> <span class="keyword">static</span> <a class="codeRef" doxygen="/home/chunywan/d/working/voba/voba_value/docs/voba_value.tag:https://wcy123.github.io/voba_value/" href="https://wcy123.github.io/voba_value/overview_8h.html#a4b4beb86106b46a64b829791f267f60b">voba_value_t</a> foo(<a class="codeRef" doxygen="/home/chunywan/d/working/voba/voba_value/docs/voba_value.tag:https://wcy123.github.io/voba_value/" href="https://wcy123.github.io/voba_value/overview_8h.html#a4b4beb86106b46a64b829791f267f60b">voba_value_t</a> <span class="keyword">self</span>, <a class="codeRef" doxygen="/home/chunywan/d/working/voba/voba_value/docs/voba_value.tag:https://wcy123.github.io/voba_value/" href="https://wcy123.github.io/voba_value/overview_8h.html#a4b4beb86106b46a64b829791f267f60b">voba_value_t</a> args)</div>
<div class="line">{</div>
<div class="line">    printf(<span class="stringliteral">&quot;hello from m1/foo.\n&quot;</span>);</div>
<div class="line">    <span class="keywordflow">return</span> <a class="codeRef" doxygen="/home/chunywan/d/working/voba/voba_value/docs/voba_value.tag:https://wcy123.github.io/voba_value/" href="https://wcy123.github.io/voba_value/small_8h.html#a0cbe908387e7765090f0ee3f4de435b8">VOBA_NIL</a>;</div>
<div class="line">}</div>
<div class="line">EXEC_ONCE_PROGN{</div>
<div class="line">    <a class="code" href="module_8h.html#a75f506da31f089d7a219f73a91a754d3">VOBA_DEFINE_MODULE_SYMBOL</a>(s_foo, <a class="codeRef" doxygen="/home/chunywan/d/working/voba/voba_value/docs/voba_value.tag:https://wcy123.github.io/voba_value/" href="https://wcy123.github.io/voba_value/fun_8h.html#afe87a8eb49c61b53146652fa7e7ac8af">voba_make_func</a>(foo));</div>
<div class="line">}</div>
<div class="line"><span class="comment">// the main entry</span></div>
<div class="line"><a class="codeRef" doxygen="/home/chunywan/d/working/voba/voba_value/docs/voba_value.tag:https://wcy123.github.io/voba_value/" href="https://wcy123.github.io/voba_value/overview_8h.html#a4b4beb86106b46a64b829791f267f60b">voba_value_t</a> voba_init(<a class="codeRef" doxygen="/home/chunywan/d/working/voba/voba_value/docs/voba_value.tag:https://wcy123.github.io/voba_value/" href="https://wcy123.github.io/voba_value/overview_8h.html#a4b4beb86106b46a64b829791f267f60b">voba_value_t</a> this_module)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">return</span> <a class="codeRef" doxygen="/home/chunywan/d/working/voba/voba_value/docs/voba_value.tag:https://wcy123.github.io/voba_value/" href="https://wcy123.github.io/voba_value/small_8h.html#a0cbe908387e7765090f0ee3f4de435b8">VOBA_NIL</a>;</div>
<div class="line">}</div>
</div><!-- fragment --> </code></li>
</ol>
<ol type="1">
<li><code>m2/_private/foo.c</code> <code> <div class="fragment"><div class="line"><span class="preprocessor">#define EXEC_ONCE_TU_NAME &quot;m2/foo&quot;</span></div>
<div class="line"><span class="preprocessor">#include &lt;voba/value.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &quot;foo.h&quot;</span></div>
<div class="line"><a class="codeRef" doxygen="/home/chunywan/d/working/voba/voba_value/docs/voba_value.tag:https://wcy123.github.io/voba_value/" href="https://wcy123.github.io/voba_value/fun_8h.html#a87beae3391f3bf28034f8507dceaa5c7">VOBA_FUNC</a> <span class="keyword">static</span> <a class="codeRef" doxygen="/home/chunywan/d/working/voba/voba_value/docs/voba_value.tag:https://wcy123.github.io/voba_value/" href="https://wcy123.github.io/voba_value/overview_8h.html#a4b4beb86106b46a64b829791f267f60b">voba_value_t</a> foo(<a class="codeRef" doxygen="/home/chunywan/d/working/voba/voba_value/docs/voba_value.tag:https://wcy123.github.io/voba_value/" href="https://wcy123.github.io/voba_value/overview_8h.html#a4b4beb86106b46a64b829791f267f60b">voba_value_t</a> <span class="keyword">self</span>, <a class="codeRef" doxygen="/home/chunywan/d/working/voba/voba_value/docs/voba_value.tag:https://wcy123.github.io/voba_value/" href="https://wcy123.github.io/voba_value/overview_8h.html#a4b4beb86106b46a64b829791f267f60b">voba_value_t</a> args)</div>
<div class="line">{</div>
<div class="line">    printf(<span class="stringliteral">&quot;hello from m2/foo.\n&quot;</span>);</div>
<div class="line">    <span class="keywordflow">return</span> <a class="codeRef" doxygen="/home/chunywan/d/working/voba/voba_value/docs/voba_value.tag:https://wcy123.github.io/voba_value/" href="https://wcy123.github.io/voba_value/small_8h.html#a0cbe908387e7765090f0ee3f4de435b8">VOBA_NIL</a>;</div>
<div class="line">}</div>
<div class="line">EXEC_ONCE_PROGN{</div>
<div class="line">    <a class="code" href="module_8h.html#a75f506da31f089d7a219f73a91a754d3">VOBA_DEFINE_MODULE_SYMBOL</a>(s_foo, <a class="codeRef" doxygen="/home/chunywan/d/working/voba/voba_value/docs/voba_value.tag:https://wcy123.github.io/voba_value/" href="https://wcy123.github.io/voba_value/fun_8h.html#afe87a8eb49c61b53146652fa7e7ac8af">voba_make_func</a>(foo));</div>
<div class="line">}</div>
<div class="line"><span class="comment">// the main entry</span></div>
<div class="line"><a class="codeRef" doxygen="/home/chunywan/d/working/voba/voba_value/docs/voba_value.tag:https://wcy123.github.io/voba_value/" href="https://wcy123.github.io/voba_value/overview_8h.html#a4b4beb86106b46a64b829791f267f60b">voba_value_t</a> voba_init(<a class="codeRef" doxygen="/home/chunywan/d/working/voba/voba_value/docs/voba_value.tag:https://wcy123.github.io/voba_value/" href="https://wcy123.github.io/voba_value/overview_8h.html#a4b4beb86106b46a64b829791f267f60b">voba_value_t</a> this_module)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">return</span> <a class="codeRef" doxygen="/home/chunywan/d/working/voba/voba_value/docs/voba_value.tag:https://wcy123.github.io/voba_value/" href="https://wcy123.github.io/voba_value/small_8h.html#a0cbe908387e7765090f0ee3f4de435b8">VOBA_NIL</a>;</div>
<div class="line">}</div>
</div><!-- fragment --> </code></li>
</ol>
<h3>build everything</h3>
<p><code> </p><div class="fragment"><div class="line">set -e</div>
<div class="line"></div>
<div class="line">gcc -I ../../../build/include -I. -std=c99 -fPIC -o m1/libmain.so -shared m1/main.c</div>
<div class="line">gcc -I ../../../build/include -I. -std=c99 -fPIC -o m1/_private/libfoo.so -shared m1/_private/foo.c</div>
<div class="line">gcc -I ../../../build/include -I. -std=c99 -fPIC -o m2/libmain.so -shared m2/main.c</div>
<div class="line">gcc -I ../../../build/include -I. -std=c99 -fPIC -o m2/_private/libfoo.so -shared m2/_private/foo.c</div>
<div class="line">gcc -I ../../../build/include -std=c99 -o ex2 ex2.c \</div>
<div class="line">    -L ../../../build/lib  $LDFLAGS -lexec_once -lgc -lvoba_value -lvoba_module -ldl</div>
<div class="line">#export EXEC_ONCE_DEBUG=1</div>
<div class="line">export VOBA_PATH=.</div>
<div class="line">#export CONFIG=release</div>
<div class="line">#export YY_FLEX_DEBUG=0</div>
<div class="line">#export VOBA_MODULE_DEBUG=1</div>
<div class="line">LD_LIBRARY_PATH=../../../build/lib ./ex2</div>
</div><!-- fragment --><p> </code></p>
<h3>output</h3>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;+ set -e</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;+ gcc -I ../../../build/include -I. -std=c99 -fPIC -o m1/libmain.so -shared m1/main.c</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;+ gcc -I ../../../build/include -I. -std=c99 -fPIC -o m1/_private/libfoo.so -shared m1/_private/foo.c</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;+ gcc -I ../../../build/include -I. -std=c99 -fPIC -o m2/libmain.so -shared m2/main.c</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;+ gcc -I ../../../build/include -I. -std=c99 -fPIC -o m2/_private/libfoo.so -shared m2/_private/foo.c</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;+ gcc -I ../../../build/include -std=c99 -o ex2 ex2.c -L ../../../build/lib -lexec_once -lgc -lvoba_value -lvoba_module</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;+ LD_LIBRARY_PATH=../../../build/lib ./ex2</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;Hello from module 1</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;hello from m1/foo.</div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;hello from module 2</div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;hello from m2/foo.</div>
</div><!-- fragment --><h2>C APIs</h2>
<p>see <a class="el" href="module_8h.html">module.h</a></p>
<h2>dependency</h2>
<pre>
<div align="center">
<img src="dot_inline_dotgraph_1.png" alt="dot_inline_dotgraph_1.png" border="0" usemap="#dot_inline_dotgraph_1.map"/>
<map name="dot_inline_dotgraph_1.map" id="dot_inline_dotgraph_1.map"><area shape="rect" id="node1" href="https://wcy123.github.io/voba_module" title="voba_module" alt="" coords="112,5,211,55"/><area shape="rect" id="node2" href="https://wcy123.github.io/voba_value" title="voba_value" alt="" coords="117,103,205,152"/><area shape="rect" id="node3" href="https://wcy123.github.io/exec_once" title="exec_once" alt="" coords="5,200,91,249"/><area shape="rect" id="node4" href="https://wcy123.github.io/voba_str" title="voba_str" alt="" coords="261,200,333,249"/><area shape="rect" id="node5" href="https://wcy123.github.io/vhash" title="vhash" alt="" coords="165,200,237,249"/><area shape="rect" id="node6" href="http://www.hboehm.info/gc" title="gc" alt="" coords="176,297,248,347"/></map>
</div>

</pre><p>In order to compatible with C, only C identifier is allowed. To represent any other characters, we can use a underline followed by two hexagons, for example,</p>
<div class="fragment"><div class="line">XX(_2B)<span class="comment">/*+*/</span>                                        \</div>
<div class="line">XX(_3E)<span class="comment">/*&gt;*/</span>                                        \</div>
<div class="line">XX(_3C)<span class="comment">/*&lt;*/</span>                                        \</div>
<div class="line">XX(_3E_3D)<span class="comment">/*&gt;=*/</span>                                    \</div>
<div class="line">XX(_3C_3D)<span class="comment">/*&lt;=*/</span>                                    \</div>
<div class="line">XX(_3D_3D)<span class="comment">/*==*/</span>                                    \</div>
<div class="line">XX(_25)<span class="comment">/* % */</span>                                      \</div>
<div class="line">XX(_3C_3C)<span class="comment">/*&lt;&lt;*/</span>                                    \</div>
</div><!-- fragment --> </div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Tue Feb 3 2015 22:51:08 for the module system for language voba by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.8
</small></address>
</body>
</html>
